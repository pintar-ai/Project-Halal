<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard


* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com



=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>Halal Service</title>

  <!--leaflet css-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin="" />

  <!-- Make sure you put this AFTER Leaflet's CSS -->
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
      integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
      crossorigin=""></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />

  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>

  <!-- Favicon -->
  <link rel="icon" href="{{url_for('static', filename='assets1/img/brand/favicon.png')}}" type="image/png">
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="{{url_for('static', filename='assets1/vendor/nucleo/css/nucleo.css')}}" type="text/css">
  <link rel="stylesheet" href="{{url_for('static', filename='assets1/vendor/@fortawesome/fontawesome-free/css/all.min.css')}}" type="text/css">
  <!-- Page plugins -->
  <!-- Argon CSS -->
  <link rel="stylesheet" href="{{url_for('static', filename='assets1/css/argon.css', v=1.2.0)}}" type="text/css">

  <!-- Older Version Datepicker CSS-->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/black-tie/jquery-ui.css">

  <style>
    * {
        box-sizing: border-box;
    }

    html {
        overflow-y: scroll;
        
    }

    #map-dafault {
        width: 100%;
        background-color: white;
        height: 100%;
        position: absolute;
        z-index: 1;
        /* only for demonstration, should be removed */
    }

    label {
        color:whitesmoke;
        font-weight: bold;
    }

    #topicabv {
        color:whitesmoke;
        font-weight: bold;
        margin-top: 15px;
        margin-right: 40px;
        z-index: 2;
        cursor: pointer;
        font-family: 'Raleway', sans-serif !important;
        color: rgb(109, 109, 109);
    }

    #copy {
        font-weight: bold;
        right: 0;
        position: absolute;
        font-family: 'Raleway', sans-serif !important;
        color: rgb(241, 241, 241);
    }

    #finalMessage{
        color:whitesmoke;
        font-weight: bold;
        margin-top: 15px;
        margin-right: 40px;
        z-index: 2;
        cursor: pointer;
        font-family: 'Raleway', sans-serif !important;
        color: rgb(255, 255, 255);
    }

    #status{
        color:whitesmoke;
        font-weight: bold;
        margin-top: 15px;
        margin-right: 40px;
        z-index: 2;
        cursor: pointer;
        font-family: 'Raleway', sans-serif !important;
        color: rgb(255, 255, 255);
    }


    #topiccredit {
        color:whitesmoke;
        font-weight: bold;
        margin-top: 15px;
        margin-right: 40px;
        z-index: 2;
        cursor: pointer;
        font-family: 'Raleway', sans-serif !important;
        color: rgb(109, 109, 109);
    }

    #myBtn {
        display: none; /* Hidden by default */
        position: fixed; /* Fixed/sticky position */
        bottom: 20px; /* Place the button at the bottom of the page */
        right: 30px; /* Place the button 30px from the right */
        z-index: 99; /* Make sure it does not overlap */
        border: azure; /* Remove borders */
        outline: none; /* Remove outline */
        background-color: rgb(0, 128, 255); /* Set a background color */
        color: white; /* Text color */
        cursor: pointer; /* Add a mouse pointer on hover */
        padding: 15px; /* Some padding */
        border-radius: 20px; /* Rounded corners */
        font-size: 25px; /* Increase font size */
        font-weight: 100;
    }

    #myBtn:hover {
        background-color: rgb(51, 153, 255);
        color: rgb(255, 255, 255); /* Add a dark-grey background on hover */
    }

    /* Style the button that is used to open and close the collapsible content */
    .collapsible {
      background-color: #eee;
      color: #444;
      cursor: pointer;
      padding: 18px;
      border: none;
      text-align: left;
      outline: none;
      font-size: 15px;
    }

    /* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
    .active, .collapsible:hover {
      background-color: #ccc;
    }

    /* Style the collapsible content. Note: hidden by default */
    .content {
      padding: 0 18px;
      background-color: white;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.2s ease-out;
    }
    
  </style>
</head>

<body>
  <!-- Sidenav -->
  <nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    <div class="scrollbar-inner">
      <!-- Brand -->
      <div class="sidenav-header  align-items-center">
        <a class="navbar-brand" href="javascript:void(0)">
          <img src="{{url_for('static',filename='assets1/img/brand/pintarhalallogo.png')}}" href="{{url_for('show_user')}}" class="navbar-brand-img" alt="...">
        </a>
      </div>
      <div class="navbar-inner">
        <!-- Collapse -->
        <div class="collapse navbar-collapse" id="sidenav-collapse-main">
          <!-- Divider -->
          <hr class="my-3">
          <!-- Heading -->
          <h6 class="navbar-heading p-0 text-muted">
            <span class="docs-normal" style="display: grid;text-align: center;">Guide</span>
          </h6>          
          <!-- Nav items -->
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="{{url_for('show_user')}}">
                <i class="ni ni-tv-2 text-primary"></i>
                <span class="nav-link-text">Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{url_for('show_userprofile')}}">
                <i class="ni ni-badge text-red"></i>
                <span class="nav-link-text">User Profile</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('show_recordList') }}">
                <i class="ni ni-bullet-list-67 text-default"></i>
                <span class="nav-link-text">Record List Table</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('usermap') }}">
                <i class="ni ni-pin-3 text-primary"></i>
                <span class="nav-link-text">Map</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
  <!-- Main content -->
  <div class="main-content" id="panel">
    <!-- Topnav -->
    <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <h1 class="navbar-heading p-0 text-secondary" >Halal System Server</h1>
          <!-- Navbar links -->
          <ul class="navbar-nav align-items-center  ml-md-auto " style="margin-left: 20px;">
            <li class="nav-item d-xl-none">
              <!-- Sidenav toggler -->
              <div class="pr-3 sidenav-toggler sidenav-toggler-dark" data-action="sidenav-pin" data-target="#sidenav-main">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                </div>
              </div>
            </li>
            <li class="nav-item d-sm-none">
              <a class="nav-link" href="#" data-action="search-show" data-target="#navbar-search-main">
                <i class="ni ni-zoom-split-in"></i>
              </a>
            </li>
          </ul>
          <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
            <li class="nav-item dropdown">
              <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="media align-items-center">
                  <span class="avatar avatar-sm rounded-circle">
                    <img alt="Image placeholder" src="{{url_for('static', filename='assets1/img/theme/1.png')}}">
                  </span>
                  <div class="media-body  ml-2  d-none d-lg-block">
                    <span class="mb-0 text-sm  font-weight-bold">{{username}}</span>
                  </div>
                </div>
              </a>
              <div class="dropdown-menu  dropdown-menu-right ">
                <div class="dropdown-header noti-title">
                  <h6 class="text-overflow m-0">Welcome!</h6>
                </div>
                <a href="{{url_for('show_userprofile')}}" class="dropdown-item">
                  <i class="ni ni-badge"></i>
                  <span>My profile</span>
                </a>
                <a href="{{ url_for('show_recordList') }}" class="dropdown-item">
                  <i class="ni ni-bullet-list-67"></i>
                  <span>Record List</span>
                </a>
                <a href="{{ url_for('usermap') }}" class="dropdown-item">
                  <i class="ni ni-pin-3"></i>
                  <span>Map</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="{{ url_for('logout') }}" class="dropdown-item">
                  <i class="ni ni-user-run"></i>
                  <span>Logout</span>
                </a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Header -->
    <!-- Header -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row align-items-center py-4">
            <div class="col-lg-6 col-7">
              <h6 class="h2 text-white d-inline-block mb-0">Halal Maps</h6>
              <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                  <li class="breadcrumb-item"><a href="{{url_for('show_user')}}"><i class="fas fa-home"></i></a></li>
                  <li class="breadcrumb-item"><a href="{{ url_for('usermap') }}">Maps</a></li>
                </ol>
              </nav>
            </div>
            <div class="col-lg-6 col-5 text-right">
              <a class="btn btn-secondary" data-toggle="collapse" href="#collapseExample1" role="button" aria-expanded="false" aria-controls="collapseExample">Filter with Date</a>
              <div class="collapse" id="collapseExample1" style="margin-top: 20px;">
                <div class="card card-body bg-default">
                  <form action="{{ url_for('pushadmin') }}" method="get">
                    <h3><span id="topicabv" class="text-secondary">Asset Information (Date)</span></h3>
                    <div class="col">
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-prepend">
                            <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                          </div>
                          <input style="z-index:999;" class="form-control .datepicker" name="date" id="datepicker2" placeholder="Filter by Date" >
                        </div>
                      </div>
                    </div> <br>
                    <div class="col">
                      <div class="form-group">
                          <button data-toggle="collapse" data-target=".collapse.show"  class="btn btn-primary" type="submit" value="clear">Search</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--6">
      <div class="row">
        <div class="col">
          <div class="card border-0">
            <div id="map-default" class="map-canvas" style="height: 675px;"></div>
          </div>
        </div>
      </div>
      <!-- Footer -->
      <footer class="footer pt-0">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6">
            <div class="copyright text-center  text-lg-left  text-muted">
              &copy; 2020 <a href="https://www.creative-tim.com" class="font-weight-bold ml-1" target="_blank">Halal Service</a>
            </div>
          </div>
          <div class="col-lg-6">
            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
              <li class="nav-item">
                <a href="https://www.creative-tim.com" class="nav-link" target="_blank">Home</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/presentation" class="nav-link" target="_blank">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- Argon Scripts -->
  <!-- Core -->
  <script src="{{url_for('static', filename='assets1/vendor/jquery/dist/jquery.min.js')}}"></script>
  <script src="{{url_for('static', filename='assets1/vendor/bootstrap/dist/js/bootstrap.bundle.min.js')}}"></script>
  <script src="{{url_for('static', filename='assets1/vendor/js-cookie/js.cookie.js')}}"></script>
  <script src="{{url_for('static', filename='assets1/vendor/jquery.scrollbar/jquery.scrollbar.min.js')}}"></script>
  <script src="{{url_for('static', filename='assets1/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js')}}"></script>
  <!-- Optional JS -->
  <script src="{{url_for('static', filename='assets1/vendor/chart.js/dist/Chart.min.js')}}"></script>
  <script src="{{url_for('static', filename='assets1/vendor/chart.js/dist/Chart.extension.js')}}"></script>
  <!-- Argon JS -->
  <script src="{{url_for('static', filename='assets1/js/argon.js', v=1.2.0)}}"></script>

  <!-- Old Version Datepicker -->
  <script src="{{url_for('static', filename='assets/js/core/jquery.3.2.1.min.js')}}" type="text/javascript"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <script type="text/javascript">
    jQuery(function () {

      var enableDays = {{ data| safe}};

      function enableAllTheseDays(date) {
        var sdate = $.datepicker.formatDate('yy-mm-dd', date)
        console.log(sdate)
        if ($.inArray(sdate, enableDays) != -1) {
          return [true];
        }
        return [false];
      }

      $('#datepicker2').datepicker({ dateFormat: 'yy-mm-dd', beforeShowDay: enableAllTheseDays });
    })
  </script>

  <script type="text/javascript">
    var captured = {{ marker| tojson }};
    var captelco = {{ telco| tojson }};
    var marker;

    var mapdiv = L.map('map-default');
    
    /*
    L.tileLayer("{{ url_for('mapbox_proxy') }}?location={z}/{x}/{y}", {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18
    }).addTo(mapdiv);
    */

    
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.satellite',
            accessToken: 'pk.eyJ1IjoicGVyY2VwdHJvbnNlcnZpY2VzIiwiYSI6ImNqdnEyZWM4NDJmZWo0OXFvNnZmMDgwODcifQ.XbWZ8kPvVjiOF8QgyoQeuA'
    }).addTo(mapdiv);
    
    

  </script>

<script>

  if ({{ min1 }} == 0 && {{ min2 }} == 0 && {{ max1 }} == 0 && {{ max2 }} == 0 ) {
    
    //console.log("enter normal")
    //console.log({{ center }})
    //var lonLat = new OpenLayers.LonLat({{ center }} ).transform(epsg4326, projectTo);
    //console.log(lonLat)
    var zoom = 4;
    mapdiv.setView([ {{clat}}, {{clon}}], 11)
          //var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
          //var vectorLayer2 = new OpenLayers.Layer.Vector("Overlay");
    }
    
  else {
    
    console.log("enter bound")
    //bounds = new OpenLayers.Bounds();
    //bounds.extend(new OpenLayers.LonLat({{ max1 }}, {{ min1 }}));
    //bounds.extend(new OpenLayers.LonLat({{ max2 }}, {{ min2 }}));
          var c1=L.latLng({{ min1 }}, {{ max1 }});
          var c2=L.latLng({{ min2 }}, {{ max2 }});
          mapdiv.fitBounds([[c1],
          [c2]
          ])
    //console.log(" Latitude, Latitude, Longitude, Longitude -> "+bounds.toBBOX()); //check the bounds
    //var center_lat = bounds.getCenterLonLat()["lat"]
    //var center_lon = bounds.getCenterLonLat()["lon"]
    //var lon2 = new OpenLayers.LonLat(center_lon,center_lat).transform(epsg4326, projectTo);
    //map.getExtent(bounds);
    //map.zoomToExtent(bounds);
    //map.zoomTo(map.getZoomForExtent(bounds));
    //mapdiv.setView([ {{clat}}, {{clon}}], 15)
    //console.log(bounds.getCenterLonLat())
          //var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
          //var vectorLayer2 = new OpenLayers.Layer.Vector("Overlay");
    
  }

  // Define markers as "features" of the vector layer:

      var greenIcon = L.icon({
          iconUrl: "{{url_for('static', filename='antenna.png')}}",

          iconSize:     [35, 32], // size of the icon
      });

      var cameracon = L.icon({
          iconUrl: "{{url_for('static', filename='marker.png')}}",

          iconSize:     [36, 37], // size of the icon
      });

      for (var object in captured) {
          lat         = captured[object].lat;
          lon         = captured[object].lng;
          description = captured[object].description;
          
          marker = new L.marker([lat,lon], {icon: cameracon})
              .bindPopup(captured[object].description)
              .addTo(mapdiv);
      }

      var markers = L.markerClusterGroup({
          spiderfyOnMaxZoom: true,
          showCoverageOnHover: true,
          zoomToBoundsOnClick: true,
      });

      for (var object in captelco) {
          lat1         = captelco[object].lat;
          lon1         = captelco[object].lng;
          description = captelco[object].description;
          
          marker2 = L.marker(new L.LatLng(lat1,lon1), {icon: cameracon});
          marker2.bindPopup(captelco[object].description);
          markers.addLayer(marker2);
      }
      mapdiv.addLayer(markers);
      mapdiv.addLayer(marker);

</script>
  
  <script>
      $("#first-choice").change(function() {
          $("#second-choice").load("{{url_for('static', filename='districtdata3/')}}" + $(this).val() + ".txt");
      });
  </script>
  
  <script>
      
      $("#filterUsername").change(function(){
          var username = $("[id=filterUsername]").val()
              $.ajax({
                  url: '/getAssetUsername', 
                  type: 'POST', 
                  data: {username : $('#filterUsername').val()},
  
                  success: function(e){
                      var captured = JSON.parse(e.marker);
                      let arrayOfMarkers = [];
  
                      if (mapdiv) {
                          markers.clearLayers();
  
                          for (var object in captured) {
                              lat         = captured[object].lat;
                              lon         = captured[object].lng;
                              description = captured[object].description;
                              arrayOfMarkers.push([lat, lon])
                              
                              marker2 = L.marker(new L.LatLng(lat,lon), {icon: cameracon});
                              marker2.bindPopup(description);
                              markers.addLayer(marker2);
                          }
                          var bounds = new L.LatLngBounds(arrayOfMarkers);
                          mapdiv.fitBounds(bounds);
                      }
              }});
      });
  
  
  </script>
  
  <script>
      function isFunction(functionToCheck) {
    return functionToCheck && {}.toString.call(functionToCheck) === '[object Function]';
  }
  
  function debounce(func, wait) {
      var timeout;
      var waitFunc;
  
      return function() {
          if (isFunction(wait)) {
              waitFunc = wait;
          }
          else {
              waitFunc = function() { return wait };
          }
  
          var context = this, args = arguments;
          var later = function() {
              timeout = null;
              func.apply(context, args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, waitFunc());
      };
  }
  
  // reconnectFrequencySeconds doubles every retry
  var reconnectFrequencySeconds = 1;
  var evtSource;
  
  var reconnectFunc = debounce(function() {
      setupEventSource();
      // Double every attempt to avoid overwhelming server
      reconnectFrequencySeconds *= 2;
      // Max out at ~1 minute as a compromise between user experience and server load
      if (reconnectFrequencySeconds >= 64) {
          reconnectFrequencySeconds = 64;
      }
  }, function() { return reconnectFrequencySeconds * 1000 });
  /*
  var source = new EventSource('/stream');
  source.onmessage = function (event) {
    if(event.data!="no data"){
      alert(event.data);
    }
      
  };
  */
  function setupEventSource() {
    evtSource = new EventSource('/streamadminmap'); 
    evtSource.onmessage = function(e) {
      $(document).ready(function () {
  
          window.setTimeout(function() {
              $(".alert").fadeTo(1000, 0).slideUp(1000, function(){
                  $(this).remove(); 
              });
          }, 5000);
          
          });
      // Handle even here
      if(e.data!="no data"){
      
      //console.log(e.data)
      var captured = $.parseJSON(e.data);
  
      if (mapdiv) {
          let arrayOfMarkers = [];
          markers.clearLayers();
  
          for (var object in captured) {
              lat         = captured[object].lat;
              lon         = captured[object].lng;
              description = captured[object].description;
              arrayOfMarkers.push([lat, lon])
              marker2 = L.marker(new L.LatLng(lat,lon), {icon: cameracon});
              marker2.bindPopup(description);
              markers.addLayer(marker2);
          }
          var bounds = new L.LatLngBounds(arrayOfMarkers);
          mapdiv.fitBounds(bounds);
      }
  
      
    }
    };
    evtSource.onopen = function(e) {
      // Reset reconnect frequency upon successful connection
      reconnectFrequencySeconds = 1;
    };
    evtSource.onerror = function(e) {
      evtSource.close();
      reconnectFunc();
    };
  }
  setupEventSource();
  </script>

  <script>
    var coll = document.getElementsByClassName("collapsible");
    var i;
    
    for (i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.maxHeight){
          content.style.maxHeight = null;
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
        }
      });
    }
  </script>
</body>

</html>
